
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .admin-only { display: none; }
        .user-admin .admin-only { display: block; }
        .transition-all { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden transition-all transform hover:scale-[1.01]">
        <div class="bg-indigo-600 text-white p-6 text-center">
            <h1 class="text-2xl font-bold">用户管理系统</h1>
            <p class="opacity-90">请登录或注册账户</p>
        </div>

        <div class="p-6">
            <!-- 选项卡导航 -->
            <div class="flex border-b mb-6">
                <button class="tab-btn py-2 px-4 font-medium text-indigo-600 border-b-2 border-indigo-600" data-tab="login">登录</button>
                <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="register">注册</button>
                <button class="tab-btn py-2 px-4 font-medium text-gray-500" data-tab="forgot">忘记密码</button>
            </div>

            <!-- 登录表单 -->
            <div id="login" class="tab-content active">
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1">用户名</label>
                        <input type="text" name="username" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">密码</label>
                        <input type="password" name="password" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-all">登录</button>
                </form>
            </div>

            <!-- 注册表单 -->
            <div id="register" class="tab-content">
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1">用户名</label>
                        <input type="text" name="username" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">邮箱</label>
                        <input type="email" name="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">密码</label>
                        <input type="password" name="password" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="admin-only">
                        <label class="flex items-center">
                            <input type="checkbox" name="isAdmin" class="rounded text-indigo-600">
                            <span class="ml-2 text-gray-700">设为管理员</span>
                        </label>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-all">注册</button>
                </form>
            </div>

            <!-- 忘记密码表单 -->
            <div id="forgot" class="tab-content">
                <form id="forgotForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1">用户名</label>
                        <input type="text" name="username" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">邮箱</label>
                        <input type="email" name="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">新密码</label>
                        <input type="password" name="newPassword" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-all">重置密码</button>
                </form>
            </div>

            <!-- 修改密码表单 (登录后显示) -->
            <div id="changePassword" class="tab-content hidden">
                <form id="changePasswordForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-1">当前密码</label>
                        <input type="password" name="currentPassword" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">新密码</label>
                        <input type="password" name="newPassword" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-1">确认新密码</label>
                        <input type="password" name="confirmPassword" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-all">修改密码</button>
                </form>
            </div>

            <!-- 用户信息展示 (登录后显示) -->
            <div id="userInfo" class="hidden">
                <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                    <h3 class="font-bold text-indigo-800">欢迎, <span id="displayUsername"></span></h3>
                    <p class="text-sm text-indigo-600">角色: <span id="displayRole"></span></p>
                </div>
                <button id="changePasswordBtn" class="w-full bg-indigo-100 text-indigo-700 py-2 rounded-lg hover:bg-indigo-200 transition-all mb-4">
                    修改密码
                </button>
                <button id="logoutBtn" class="w-full bg-red-100 text-red-700 py-2 rounded-lg hover:bg-red-200 transition-all">
                    退出登录
                </button>
            </div>
        </div>
    </div>

    <script>
        // 初始化用户数据存储
        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([
                { username: 'admin', email: 'admin@example.com', password: 'admin123', isAdmin: true },
                { username: 'user1', email: 'user1@example.com', password: 'user123', isAdmin: false }
            ]));
        }

        // 获取DOM元素
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotForm = document.getElementById('forgotForm');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const userInfoSection = document.getElementById('userInfo');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const displayUsername = document.getElementById('displayUsername');
        const displayRole = document.getElementById('displayRole');

        // 当前登录用户
        let currentUser = null;

        // 检查是否已登录
        if (localStorage.getItem('currentUser')) {
            currentUser = JSON.parse(localStorage.getItem('currentUser'));
            showUserInfo();
        }

        // 选项卡切换
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                
                // 更新按钮样式
                tabBtns.forEach(b => {
                    b.classList.remove('text-indigo-600', 'border-indigo-600');
                    b.classList.add('text-gray-500');
                });
                btn.classList.add('text-indigo-600', 'border-indigo-600');
                btn.classList.remove('text-gray-500');
                
                // 显示对应内容
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
            });
        });

        // 登录表单提交
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = loginForm.username.value;
            const password = loginForm.password.value;
            
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showUserInfo();
                // 模拟跳转到dashboard.html
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 1000);
            } else {
                alert('用户名或密码错误');
            }
        });

        // 注册表单提交
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = registerForm.username.value;
            const email = registerForm.email.value;
            const password = registerForm.password.value;
            const isAdmin = registerForm.isAdmin.checked;
            
            const users = JSON.parse(localStorage.getItem('users'));
            
            // 检查用户名是否已存在
            if (users.some(u => u.username === username)) {
                alert('用户名已存在');
                return;
            }
            
            // 添加新用户
            users.push({ username, email, password, isAdmin });
            localStorage.setItem('users', JSON.stringify(users));
            
            alert('注册成功，请登录');
            tabBtns[0].click(); // 切换到登录选项卡
            loginForm.username.value = username;
            loginForm.password.value = '';
        });

        // 忘记密码表单提交
        forgotForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = forgotForm.username.value;
            const email = forgotForm.email.value;
            const newPassword = forgotForm.newPassword.value;
            
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === username && u.email === email);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                alert('密码重置成功，请登录');
                tabBtns[0].click(); // 切换到登录选项卡
                loginForm.username.value = username;
                loginForm.password.value = '';
            } else {
                alert('用户名和邮箱不匹配');
            }
        });

        // 修改密码表单提交
        changePasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const currentPassword = changePasswordForm.currentPassword.value;
            const newPassword = changePasswordForm.newPassword.value;
            const confirmPassword = changePasswordForm.confirmPassword.value;
            
            if (newPassword !== confirmPassword) {
                alert('新密码和确认密码不匹配');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                alert('当前密码错误');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                
                // 更新当前用户
                currentUser.password = newPassword;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                alert('密码修改成功');
                document.getElementById('changePassword').classList.remove('active');
                userInfoSection.classList.remove('hidden');
            }
        });

        // 显示用户信息
        function showUserInfo() {
            // 隐藏所有表单
            tabContents.forEach(content => content.classList.remove('active'));
            // 显示用户信息
            userInfoSection.classList.remove('hidden');
            displayUsername.textContent = currentUser.username;
            displayRole.textContent = currentUser.isAdmin ? '管理员' : '普通用户';
            
            // 如果是管理员，显示管理员功能
            if (currentUser.isAdmin) {
                document.body.classList.add('user-admin');
            }
        }

        // 修改密码按钮点击
        changePasswordBtn.addEventListener('click', () => {
            userInfoSection.classList.add('hidden');
            document.getElementById('changePassword').classList.add('active');
        });

        // 退出登录
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            currentUser = null;
            userInfoSection.classList.add('hidden');
            tabBtns[0].click(); // 切换到登录选项卡
            document.body.classList.remove('user-admin');
        });
    </script>
</body>
</html>
